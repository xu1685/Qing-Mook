webpackJsonp([1],{"+EMP":function(e,t,i){e.exports=i.p+"static/img/bigLogo.eeaf69c.png"},"/X/l":function(e,t){},"4ai5":function(e,t){},"5OHe":function(e,t){},Byke:function(e,t){},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("rVsN"),a=i.n(n),s=(i("5OHe"),i("wSez")),r=i.n(s),o=i("MVSX"),l=i("2sCs"),c=i.n(l),d=i("9woI"),h=i.n(d),u={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var p=i("46Yf")({name:"App"},u,!1,function(e){i("fDbG")},null,null).exports,m=i("zO6J"),f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("mt-header",{staticClass:"header",attrs:{title:this.title}},[t("a",{attrs:{slot:"left"},on:{click:this.back},slot:"left"},[t("mt-button",{attrs:{icon:"back"}})],1)])},staticRenderFns:[]};var v=i("46Yf")({name:"MyHeader",props:["title"],methods:{back:function(){this.$router.back()}}},f,!1,function(e){i("OQGB")},"data-v-3246f62e",null).exports,g=i("OmDG"),y=i.n(g),b=2,w=function(e){c.a.get("authentication/signature?url="+e).then(function(e){window.jWeixin.config({debug:!1,appId:"wxa53771df5d04e3d3",timestamp:e.data.timestamp,nonceStr:e.data.noncestr,signature:e.data.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]})}),window.jWeixin.error(function(t){b-- >0&&c.a.put("authentication/signature?url="+e).then(function(e){window.jWeixin.config({debug:!1,appId:"wxa53771df5d04e3d3",timestamp:e.data.timestamp,nonceStr:e.data.noncestr,signature:e.data.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]})})})},C=function(e){var t=e.title,i=e.desc,n=e.link,a=e.imgUrl;!function(e){var t=e.title,i=e.link,n=e.imgUrl;window.jWeixin.onMenuShareTimeline({title:t,link:i,imgUrl:n,fail:function(){alert("分享到朋友圈失败，请刷新页面重试")}})}({title:t,link:n,imgUrl:a}),function(e){var t=e.title,i=e.desc,n=e.link,a=e.imgUrl;window.jWeixin.onMenuShareAppMessage({title:t,desc:i,link:n,imgUrl:a,fail:function(){alert("分享给朋友失败，请刷新页面重试")}})}({title:t,desc:i,link:n,imgUrl:a}),function(e){var t=e.title,i=e.desc,n=e.link,a=e.imgUrl;window.jWeixin.onMenuShareQQ({title:t,desc:i,link:n,imgUrl:a,fail:function(){alert("分享到 QQ 失败，请刷新页面重试")}})}({title:t,desc:i,link:n,imgUrl:a})},x={name:"course",data:function(){return{accountId:this.$route.query.accountId,action:[],allDcos:[],courseList:[],cover:"",defaultClassCoverPng:y.a,docs:[],library:{},libraryId:this.$route.params.id,name:"课堂主页",teacherInformation:{},title:"课程列表"}},mounted:function(){var e=this;s.Indicator.open("获取课堂数据中"),this.$http.get("/players/accounts/"+this.accountId).then(function(t){var i=t.data,n=i.accounts,a=i.coopDocs,r=i.coopLibraries,o=i.docs,l=i.libraries.concat(r),c=o.concat(a);e.library=l.find(function(t){return t.id===e.libraryId}),e.teacherInformation=n.find(function(t){return String(t.id)===e.accountId}),e.library.chapters.reduce(function(e,t){return e.concat(t.docs)},e.library.docs).forEach(function(t){var i=c.find(function(e){return e.id===t});i&&"open"==i.status&&"1"==i.transformed&&i.hasAction&&e.courseList.push(i)}),s.Indicator.close();var d=e.library.name,h=e.library.cover,u=e.teacherInformation.name||e.teacherInformation.nickname,p=e.teacherInformation.introduction;w(window.encodeURIComponent(window.location.href)),window.jWeixin.ready(function(){C({title:u+":《"+d+"》专辑",desc:""+p,link:window.location.href,imgUrl:h})})}).catch(function(e){alert("获取数据错误，请检查访问地址")})},methods:{computeScore:function(e){var t=e.star1,i=e.star2,n=e.star3,a=e.star4,s=e.star5,r=(t+2*i+3*n+4*a+5*s)/(t+i+n+a+s);return window.isNaN(r)?-1:r}},components:{MyHeader:v}},k={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"coursePage"},[i("MyHeader",{attrs:{title:"【课程专辑】"}}),e._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"message"},[i("h2",{staticClass:"coursetitle"},[e._v(e._s(e.library.name))]),e._v(" "),i("div",{staticClass:"blackMask",style:{backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:e.library.isDefault?"url("+e.defaultClassCoverPng+")":e.library.cover||e.defaultClassCoverPng}})]),e._v(" "),i("hr",{staticClass:"hr1"}),e._v(" "),e._l(e.courseList,function(t){return i("div",{key:t.id,staticClass:"courseCell"},[i("router-link",{staticClass:"link",attrs:{to:{path:"/player/"+t.id}}},[i("div",{staticClass:"imgcon"},[i("div",{staticClass:"msg"},[-1!==e.computeScore(t.ratingStatis)?i("i",{staticClass:"fa fa-star",staticStyle:{"font-size":"20px",color:"#fbe359",width:"110px","margin-top":"20px"}},[e._v("\n              "+e._s(e.computeScore(t.ratingStatis))+"\n            ")]):e._e(),e._v(" "),-1===e.computeScore(t.ratingStatis)?i("span",{staticStyle:{"font-size":"20px",color:"white",width:"110px","margin-top":"20px",display:"inline-block"}},[e._v("\n              暂无评分\n            ")]):e._e()]),e._v(" "),i("div",{staticClass:"blackblock"}),e._v(" "),i("div",{staticClass:"classImg"},[i("img",{staticClass:"classImg",attrs:{src:t.cover}})])]),e._v(" "),i("div",{staticClass:"msgcontainer"},[i("div",{staticStyle:{display:"inline-block"}},[i("span",{staticClass:"className"},[e._v(e._s(t.name))])]),e._v(" "),i("div",{staticClass:"icons"},[i("i",{staticClass:"fa fa-caret-square-o-right"}),e._v(" "),i("span",{staticStyle:{display:"inline-block","margin-left":"5px"}},[e._v(e._s(t.view))]),e._v(" "),i("i",{staticClass:"fa fa-commenting-o",staticStyle:{"margin-left":"15px"}}),e._v(" "),i("span",{staticStyle:{display:"inline-block","margin-left":"5px"}},[e._v(e._s(t.commentNums))])])])]),e._v(" "),i("hr",{staticClass:"hr1"})],1)})],2)],1)},staticRenderFns:[]};var S=i("46Yf")(x,k,!1,function(e){i("Byke")},"data-v-2173d86b",null).exports,I=i("ZLEe"),O=i.n(I),T=(i("/X/l"),i("4YfN")),_=i.n(T),E=i("AA3o"),L=i.n(E),P=i("xSur"),D=i.n(P),M=i("eKId"),R=i.n(M),F={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},$=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],A=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],B=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],W="undefined"!=typeof window&&void 0!==window.document?window.document:{},U="fullscreenEnabled"in W&&O()(F)||$[0]in W&&$||A[0]in W&&A||B[0]in W&&B||[],z={requestFullscreen:function(e){return e[U[F.requestFullscreen]]()},requestFullscreenFunction:function(e){return e[U[F.requestFullscreen]]},get exitFullscreen(){return W[U[F.exitFullscreen]].bind(W)},addEventListener:function(e,t,i){return W.addEventListener(U[F[e]],t,i)},removeEventListener:function(e,t,i){return W.removeEventListener(U[F[e]],t,i)},get fullscreenEnabled(){return Boolean(W[U[F.fullscreenEnabled]])},set fullscreenEnabled(e){},get fullscreenElement(){return W[U[F.fullscreenElement]]},set fullscreenElement(e){},get onfullscreenchange(){return W[("on"+U[F.fullscreenchange]).toLowerCase()]},set onfullscreenchange(e){return W[("on"+U[F.fullscreenchange]).toLowerCase()]=e},get onfullscreenerror(){return W[("on"+U[F.fullscreenerror]).toLowerCase()]},set onfullscreenerror(e){return W[("on"+U[F.fullscreenerror]).toLowerCase()]=e}},H=function(){function e(t){var i=t.actionUrl,n=t.audioUrl,a=t.duration,s=t.element,r=t.imageUrls,o=t.mode,l=void 0===o?"mobile":o,c=t.size,d=t.subtitles;L()(this,e),this.actionData={actions:null,draftHeight:0,draftWidth:0,windowHeight:0,windowWidth:0},this.domRefs={audio:null,images:[],imageContainer:null,playerContainer:s},this.options={actionUrl:i,audioUrl:n,duration:a,element:s,imageUrls:r,mode:l,size:c,subtitles:d,scrollDuration:1,autoPlay:"mobile"===l,captionFontSize:16},this.state={audioLoadStatus:"initial",isImagesLoaded:new Array(r.length,!1),nextAction:null,nextActionIndex:0,animation:null,animationObj:null,isHalted:!0,isLoading:!0,isPageFullscreenOpen:!1,isdraftOpen:!1,draftWidth:0,draftNum:1,contexts:[],propotions:[],propotion:1,ctx:null,currentSubtitleIndex:0,subtitles:this.options.subtitles||[],isCaptionsOpen:"mobile"===l,initialWidth:s.offsetWidth,waiting:{waitingPage:null,waitingTime:null},hammers:null},this.template={playerControl:'\n        <div class="player-main">\n          <div class="player-section-left">\n            <button class="player-section player-play player-button" title="播放">\n              <i class="fa fa-play"></i>\n            </button>\n            <div class="player-section player-time">\n              <span class="current-time">0</span>\n              <span class="player-time-divider">/</span>\n              <span class="duration">'+e.normalizeTime(this.options.duration)+'</span>\n            </div>\n          </div>\n          <div class="player-section-right">\n            <button class="player-section player-button player-toggle-captions'+(this.state.isCaptionsOpen?" is-active":"")+'" title="打开字幕">\n              <svg viewBox="0 0 24 24" style="display: inline-block; fill: currentcolor; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;">\n                <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM4 12h4v2H4v-2zm10 6H4v-2h10v2zm6 0h-4v-2h4v2zm0-4H10v-2h10v2z"></path>\n              </svg>\n            </button>\n            '+("desktop"===l?'<button class="player-section player-button player-page-fullscreen" title="网页全屏">\n              <svg viewBox="0 0 24 24" style="display: inline-block; fill: currentcolor; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;">\n                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path>\n              </svg>\n              <svg viewBox="0 0 24 24" style="display: none; fill: currentcolor; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;">\n                <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path>\n              </svg>\n            </button>':"")+'\n            <button class="player-section player-button player-fullscreen" title="进入全屏">\n              <svg viewBox="0 0 24 24" style="display: inline-block; fill: currentcolor; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;">\n                <path d="M15 3l2.3 2.3-2.89 2.87 1.42 1.42L18.7 6.7 21 9V3zM3 9l2.3-2.3 2.87 2.89 1.42-1.42L6.7 5.3 9 3H3zm6 12l-2.3-2.3 2.89-2.87-1.42-1.42L5.3 17.3 3 15v6zm12-6l-2.3 2.3-2.87-2.89-1.42 1.42 2.89 2.87L15 21h6z"></path>\n              </svg>\n            </button>\n          </div>\n          <div class="player-progress-control">\n            <div class="player-progressbar-wrap">\n              <div class="player-progressbar">\n                <div class="player-progressbar-handle">\n                <i class="fa fa-circle"></i>\n                </div>\n              </div>\n              <div class="player-preview"></div>\n            </div>\n          </div>\n        </div>\n      ',loadTip:'\n        <div class="player-load-tip">\n          <button class="player-load-button">\n            <i class="fa fa-play" aria-hidden="true"></i>\n            <span>'+Math.round(c/1024/1024)+'MB流量</span>\n          </button>\n          <div class="player-loading">\n            <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>\n            <div>正在加载...</div>\n          </div>\n        </div>\n      ',draft:'\n        <canvas class="draft"></canvas>\n      ',captions:'\n        <div class="player-captions">\n          '+("desktop"===l?'<i class="fa fa-ellipsis-v" aria-hidden="true"></i>':"")+'\n          <span class="player-captions-text">(播放开始时将出现字幕)</span>\n        </div>\n      '},this.fetchActions(),this.fetchImages()}return D()(e,null,[{key:"formatActionData",value:function(e){return{actions:e.actions.map(function(e,t){return _()({},e,{actionId:t,color:e.color,endTime:e.endTime?100*Math.round(10*window.parseFloat(e.endTime)):void 0,id:e.id,points:e.points?e.points.map(function(e){return[window.parseFloat(e.x),window.parseFloat(e.y)]}):void 0,startTime:100*Math.round(10*window.parseFloat(e.startTime)),target:e.target,type:e.type,width:e.width?window.parseInt(e.width,10):void 0,yDistance:e.yDistance?window.parseInt(e.yDistance,10):void 0})}).sort(function(e,t){return e.startTime-t.startTime}),draftHeight:window.parseInt(e.draftHeight,10),draftWidth:window.parseInt(e.draftWidth,10),windowHeight:window.parseInt(e.windowHeight,10),windowWidth:window.parseInt(e.windowWidth,10)}}}]),D()(e,[{key:"fetchActions",value:function(){var t=this;c.a.get(this.options.actionUrl,{baseURL:"",responseType:"json"}).then(function(i){t.actionData=e.formatActionData(i.data),t.renderContainer(),t.renderImages()}).catch(function(e){throw e})}},{key:"renderContainer",value:function(){var t=this.actionData,i=t.windowHeight,n=t.windowWidth,a=this.domRefs.playerContainer,s=this.options.mode,r=this.template.loadTip,o=document.createElement("div");o.className="player-image-container";var l=a.offsetWidth,c=l*i/n;o.style.width=l+"px",o.style.height=c+"px",a.appendChild(o);var d=e.renderStringToNode(o,r);this.domRefs.loadTip=d,this.domRefs.imageContainer=o,this.domRefs.loading=d.querySelector(".player-loading");var h=new CustomEvent("actionsLoaded");a.dispatchEvent(h),this.fetchSource=this.fetchSource.bind(this);var u=d.querySelector(".player-load-button");"mobile"===s?u.addEventListener("click",this.fetchSource):this.fetchSource()}},{key:"fetchSource",value:function(){var e=this.domRefs.loadTip;this.fetchAudio(),e.firstElementChild.style.display="none",e.lastElementChild.style.display="block"}},{key:"fetchAudio",value:function(){var e=document.createElement("audio");this.handleAudioLoaded=this.handleAudioLoaded.bind(this),e.addEventListener("canplay",this.handleAudioLoaded),e.addEventListener("canplaythrough",this.handleAudioLoaded),e.addEventListener("loadeddata",this.handleAudioLoaded),e.addEventListener("loadedmetadata",this.handleAudioLoaded),e.src=this.options.audioUrl,this.domRefs.audio=e,this.state.audioLoadStatus="loading"}},{key:"fetchImages",value:function(){var e=this,t=/p(\d+)\.png$/,i=this.options.imageUrls.sort(function(e,i){return Number(e.match(t)[1])-Number(i.match(t)[1])});this.options.imageUrls=i;var n=this.domRefs.playerContainer.offsetWidth;this.handleImageLoaded=this.handleImageLoaded.bind(this),this.domRefs.images=i.map(function(){var t=new Image(n);return t.addEventListener("load",e.handleImageLoaded),t}),this.handleFirstImageLoaded=this.handleFirstImageLoaded.bind(this),this.domRefs.images[0].addEventListener("load",this.handleFirstImageLoaded),this.domRefs.images[0].src=i[0]}},{key:"handleFirstImageLoaded",value:function(){var e=this;this.checkSrcLoadStatus(),this.domRefs.images.forEach(function(t,i){i&&(t.src=e.options.imageUrls[i])})}},{key:"handleImageLoaded",value:function(e){var t=parseInt(e.target.src.match(/p(\d+)\.png$/)[1],10);this.state.isImagesLoaded[t]=!0}},{key:"handleAudioLoaded",value:function(){this.state.audioLoadStatus="finish",this.checkSrcLoadStatus()}},{key:"checkSrcLoadStatus",value:function(){"finish"===this.state.audioLoadStatus&&this.state.isImagesLoaded[0]&&!this.state.canPlay&&(this.state.canPlay=!0,this.setLoadingTipStatus(!1),this.initHtml(),this.bindEvents(),this.setDrawTarget(),this.setPropotions(),this.changeCurrentTime(0),this.options.autoPlay&&this.togglePlay(),this.showPlayerControl())}},{key:"initHtml",value:function(){this.renderCanvas(),this.renderPlayerControl(),this.renderCaptions(),this.renderAudio(),this.renderDraft()}},{key:"setLoadingTipStatus",value:function(e){this.state.isLoading=e,this.domRefs.loading.style.display=this.state.isLoading?"block":"none"}},{key:"renderImages",value:function(){var e=this,t=this.domRefs,i=t.images,n=t.imageContainer;this.domRefs.pages=[];var a=document.createDocumentFragment();i.forEach(function(t){var i=document.createElement("section");i.classList.add("player-image-section"),t.classList.add("player-image"),i.appendChild(t),a.appendChild(i),e.domRefs.pages.push(i)}),n.appendChild(a)}},{key:"renderCanvas",value:function(){var e=document.createElement("canvas");this.domRefs.canvas=e;var t=this.domRefs.imageContainer;this.setCanvasSize(t.offsetWidth),e.classList.add("player-canvas"),t.appendChild(e);var i=e.getContext("2d");i.lineCap="round",this.state.contexts.push(i)}},{key:"renderAudio",value:function(){var e=this.domRefs,t=e.audio;e.playerContainer.appendChild(t)}},{key:"renderPlayerControl",value:function(){var t=this.domRefs.playerContainer,i=this.template.playerControl,n=e.renderStringToNode(t,i);this.domRefs.playerControl=n,this.domRefs.progressbarWrapper=n.querySelector(".player-progressbar-wrap"),this.domRefs.playState=n.querySelector(".player-play"),this.domRefs.fullscreen=n.querySelector(".player-fullscreen"),this.domRefs.pageFullscreen=n.querySelector(".player-page-fullscreen"),this.domRefs.toggleCaptionsButton=n.querySelector(".player-toggle-captions"),this.domRefs.duration=n.querySelector(".duration"),this.domRefs.currentTime=n.querySelector(".current-time"),this.domRefs.progressbar=n.querySelector(".player-progressbar"),this.domRefs.preview=n.querySelector(".player-preview"),this.domRefs.progressHandle=n.querySelector(".player-progressbar-handle")}},{key:"renderCaptions",value:function(){var t=this.domRefs.playerContainer,i=e.renderStringToNode(t,this.template.captions);this.state.isCaptionsOpen||(i.style.display="none"),this.domRefs.captions=i}},{key:"renderDraft",value:function(){var t=e.renderStringToNode(this.domRefs.imageContainer,this.template.draft),i=t.getContext("2d");i.lineCap="round",this.state.contexts.push(i),this.domRefs.draft=t,this.setDraftSize()}},{key:"bindEvents",value:function(){var e=this.domRefs,t=e.audio,i=e.fullscreen,n=e.pageFullscreen,a=e.playState,s=e.progressbarWrapper,r=e.playerControl,o=e.progressHandle,l=e.toggleCaptionsButton,c=e.captions,d=e.loadTip;if(this.handlePlayButtonClick=this.handlePlayButtonClick.bind(this),this.handleFullscreenClick=this.handleFullscreenClick.bind(this),this.handleCaptionsMove=this.handleCaptionsMove.bind(this),this.showPlayerControl=this.showPlayerControl.bind(this),this.handleCaptionsDown=this.handleCaptionsDown.bind(this),this.handleCaptionsUp=this.handleCaptionsUp.bind(this),this.handlePageFullscreenClick=this.handlePageFullscreenClick.bind(this),this.handleProgressbarOver=this.handleProgressbarOver.bind(this),this.handleProgressbarleave=this.handleProgressbarleave.bind(this),this.handleSeekMousedown=this.handleSeekMousedown.bind(this),this.handleTimeUpdate=this.handleTimeUpdate.bind(this),this.handleEnded=this.handleEnded.bind(this),this.handleFullscreenChange=this.handleFullscreenChange.bind(this),this.handleCaptionButtonClick=this.handleCaptionButtonClick.bind(this),this.handleProgressbarClick=this.handleProgressbarClick.bind(this),this.handleRotateScreen=this.handleRotateScreen.bind(this),this.handleWindowResize=this.handleWindowResize.bind(this),"desktop"===this.options.mode&&(r.addEventListener("mouseenter",this.showPlayerControl),r.addEventListener("mousemove",this.showPlayerControl),d.addEventListener("mouseenter",this.showPlayerControl),d.addEventListener("mousemove",this.showPlayerControl),d.addEventListener("click",this.handlePlayButtonClick),n.addEventListener("click",this.handlePageFullscreenClick),s.addEventListener("mouseover",this.handleProgressbarOver),s.addEventListener("mouseleave",this.handleProgressbarleave),s.addEventListener("mousemove",this.handleProgressbarOver),o.addEventListener("mousedown",this.handleSeekMousedown),c.addEventListener("mousedown",this.handleCaptionsDown)),t.addEventListener("timeupdate",this.handleTimeUpdate),t.addEventListener("ended",this.handleEnded),a.addEventListener("click",this.handlePlayButtonClick),z.addEventListener("fullscreenchange",this.handleFullscreenChange),i.addEventListener("click",this.handleFullscreenClick),l.addEventListener("click",this.handleCaptionButtonClick),s.addEventListener("click",this.handleProgressbarClick),window.addEventListener("orientationchange",this.handleRotateScreen),window.addEventListener("resize",this.handleWindowResize),"mobile"===this.options.mode){this.handlePlayerTap=this.handlePlayerTap.bind(this),this.handleProgressPanStart=this.handleProgressPanStart.bind(this),this.handleProgressPanMove=this.handleProgressPanMove.bind(this),this.handleCaptionsPress=this.handleCaptionsPress.bind(this),this.handleCaptionsPressUp=this.handleCaptionsPressUp.bind(this),this.handleCaptionsPanMove=this.handleCaptionsPanMove.bind(this),this.handlePlayerDoubleTap=this.handlePlayerDoubleTap.bind(this);var h=new R.a(o);h.on("panstart",this.handleProgressPanStart),h.on("panleft panright",this.handleProgressPanMove);var u=new R.a(c);u.get("pan").set({direction:R.a.DIRECTION_ALL}),u.get("press").set({time:500}),u.on("press",this.handleCaptionsPress),u.on("panleft panright panup pandown",this.handleCaptionsPanMove),u.on("panend",this.handleCaptionsPressUp);var p=new R.a.Manager(d,{recognizers:[[R.a.Pan]]});p.add(new R.a.Tap({event:"doubletap",taps:2})),p.add(new R.a.Tap({event:"singletap"})),p.get("doubletap").recognizeWith("singletap"),p.get("singletap").requireFailure("doubletap"),p.on("singletap",this.handlePlayerTap),p.on("doubletap",this.handlePlayerDoubleTap),p.on("panstart",this.handleProgressPanStart),p.on("panleft panright",this.handleProgressPanMove),this.state.hammers={handleHammer:h,captionsHammer:u,loadTipHammer:p}}}},{key:"handleCaptionsPress",value:function(){var e=this.domRefs.captions;this.canCaptionsMove=!0,this.captionsStartX=e.offsetLeft,this.captionsStartY=e.offsetTop}},{key:"handleCaptionsPressUp",value:function(){this.canCaptionsMove=!1}},{key:"handleCaptionsPanMove",value:function(e){if(this.canCaptionsMove){var t=this.captionsStartX+e.deltaX,i=this.captionsStartY+e.deltaY;this.setCaptionsOffset(t,i)}}},{key:"handleProgressPanStart",value:function(){var e=this.domRefs.audio;this.panStartTime=e.currentTime}},{key:"handleProgressPanMove",value:function(e){var t=this.domRefs.progressbarWrapper,i=this.options.duration,n=i*(e.deltaX/t.offsetWidth),a=this.panStartTime+n;a=Math.min(i,a),a=Math.max(0,a),this.showPlayerControl(),this.changeCurrentTime(1e3*a)}},{key:"handlePlayerTap",value:function(e){e.preventDefault(),this.showPlayerControl()}},{key:"handleCaptionsDown",value:function(e){var t=this.domRefs.captions;document.addEventListener("mousemove",this.handleCaptionsMove),document.addEventListener("mouseup",this.handleCaptionsUp),this.captionsStartX=t.offsetLeft,this.captionsStartY=t.offsetTop,this.cursorStartX=e.clientX,this.cursorStartY=e.clientY}},{key:"handleCaptionsUp",value:function(){document.removeEventListener("mousemove",this.handleCaptionsMove),document.removeEventListener("mouseup",this.handleCaptionsUp)}},{key:"handleCaptionsMove",value:function(e){var t=e.clientX-this.cursorStartX,i=e.clientY-this.cursorStartY,n=this.captionsStartX+t,a=this.captionsStartY+i;this.setCaptionsOffset(n,a)}},{key:"setCaptionsOffset",value:function(e,t){var i=this.domRefs,n=i.captions,a=i.playerContainer,s=i.playerControl,r=a.offsetWidth,o=a.offsetHeight,l=r-n.offsetWidth,c=o-n.offsetHeight,d=e;d=Math.max(0,d),d=Math.min(l,d),n.style.left=d/r*100+"%";var h=o-t-n.offsetHeight;h=Math.max(s.offsetHeight,h),h=Math.min(c,h),n.style.bottom=h/o*100+"%"}},{key:"handleWindowResize",value:function(){var e=this.domRefs.playerContainer,t=e.offsetWidth;this.lastWidth&&this.lastWidth===t||this.resizePlayer(e.offsetWidth),this.lastWidth=t}},{key:"handleEnded",value:function(){this.togglePlay(),this.changeCurrentTime(0)}},{key:"handleSeekMousedown",value:function(){this.handleSeekMousemove=this.handleSeekMousemove.bind(this),this.handleSeekMouseup=this.handleSeekMouseup.bind(this),document.addEventListener("mousemove",this.handleSeekMousemove),document.addEventListener("mouseup",this.handleSeekMouseup)}},{key:"handleSeekMousemove",value:function(e){this.changeProgressbarHandle(e)}},{key:"handleSeekMouseup",value:function(){document.removeEventListener("mousemove",this.handleSeekMousemove),document.removeEventListener("mouseup",this.handleSeekMouseup)}},{key:"getFullscreenSize",value:function(){var e=window.screen,t=e.height,i=e.width,n=this.actionData,a=n.windowHeight/n.windowWidth,s=void 0;return a>t/i?s=t/a:(s=i)*a,s}},{key:"handleRotateScreen",value:function(){if(z.fullscreenElement){var e=this.getFullscreenSize();this.domRefs.playerContainer.style.width=e+"px",this.resizePlayer(e)}}},{key:"handleFullscreenChange",value:function(){var e=this.domRefs,t=e.fullscreen,i=e.pageFullscreen,n=e.playerContainer,a=this.options.mode,s=this.state,r=s.initialWidth,o=s.isPageFullscreenOpen;if(z.fullscreenElement){var l=this.getFullscreenSize();n.style.width=l+"px",this.resizePlayer(l),t.title="退出全屏","desktop"===a&&(i.style.display="none")}else n.style.width=o?"100%":r+"px",this.resizePlayer(n.offsetWidth),t.title="进入全屏","desktop"===a&&(i.style.display="inline")}},{key:"setPropotions",value:function(){var e=this.actionData,t=e.windowWidth,i=e.draftHeight,n=this.domRefs.imageContainer,a=this.state.propotions;a[0]=n.offsetWidth/t,a[1]=n.offsetHeight/i}},{key:"resizePlayer",value:function(e){var t=this.domRefs,i=t.audio,n=t.playerControl,a=t.captions,s=this.actionData,r=s.windowWidth,o=s.windowHeight/r*e,l=0,c=e;z.fullscreenElement&&(c=window.screen.width,l=(window.screen.width-e)/2),n.style.width=c+"px",n.style.transform="translateX("+-l+"px)",this.setContainerSize(e,o),this.setCanvasSize(e),this.setPropotions(),this.setDrawTarget(),this.setDraftSize(),this.changeCurrentTime(1e3*i.currentTime);var d=e/this.state.initialWidth;a.style.fontSize=this.options.captionFontSize*d+"px"}},{key:"handleFullscreenClick",value:function(){var e=this.domRefs.playerContainer;z.fullscreenElement?z.exitFullscreen():z.requestFullscreen(e)}},{key:"handlePageFullscreenClick",value:function(){var e=this.domRefs,t=e.playerContainer,i=e.pageFullscreen;this.state.isPageFullscreenOpen=!this.state.isPageFullscreenOpen,this.state.isPageFullscreenOpen?(i.firstElementChild.style.display="none",i.lastElementChild.style.display="inline-block",t.style.width="100%",this.resizePlayer(t.offsetWidth)):(i.firstElementChild.style.display="inline-block",i.lastElementChild.style.display="none",t.style.width=this.state.initialWidth+"px",this.resizePlayer(t.offsetWidth))}},{key:"handleCaptionButtonClick",value:function(){var e=this.state.isCaptionsOpen,t=this.domRefs,i=t.toggleCaptionsButton,n=t.captions;this.state.isCaptionsOpen=!e,this.state.isCaptionsOpen?(i.classList.add("is-active"),n.style.display="block"):(i.classList.remove("is-active"),n.style.display="none")}},{key:"setContainerSize",value:function(e,t){var i=this.domRefs.imageContainer;i.style.width=e+"px",i.style.height=t+"px"}},{key:"setCanvasSize",value:function(e){var t=this.domRefs,i=t.images,n=t.canvas,a=t.playerContainer;n.width=e;var s=i.reduce(function(e,t){return Math.max(e,t.offsetHeight)},0);n.height=Math.max(s,a.offsetHeight)}},{key:"setDraftSize",value:function(){var e=this.domRefs,t=e.draft,i=e.imageContainer,n=this.actionData.draftWidth,a=this.state.propotions,s=i.offsetHeight,r=n*a[1];t.width=r,t.height=s,this.state.draftWidth=r}},{key:"handleTimeUpdate",value:function(e){this.rerenderTimeInfo();var t=1e3*e.target.currentTime;this.changeDisplaySubtitle(t)}},{key:"rerenderTimeInfo",value:function(){var t=this.domRefs,i=t.audio,n=t.currentTime,a=t.duration,s=t.progressbar,r=this.options.duration;n.textContent=e.normalizeTime(i.currentTime),a.textContent=e.normalizeTime(r),s.style.width=i.currentTime/r*100+"%"}},{key:"handleProgressbarOver",value:function(e){var t=this.domRefs.preview,i=this.options.duration,n=this.getCursorTime(e);n/=1e3,t.style.left=n/i*100+"%",t.style.visibility="visible"}},{key:"handleProgressbarleave",value:function(){this.domRefs.preview.style.visibility="hidden"}},{key:"handleProgressbarClick",value:function(e){this.changeProgressbarHandle(e)}},{key:"changeProgressbarHandle",value:function(e){var t=this.getCursorTime(e);this.changeCurrentTime(t)}},{key:"showPlayerControl",value:function(){var e=this.domRefs.playerControl,t=this.state.hidePlayerControl;t&&window.clearTimeout(t),e.classList.remove("fade-out"),e.style.opacity="1",this.state.hidePlayerControl=window.setTimeout(this.fadeOutPlayerControl.bind(this),3e3)}},{key:"fadeOutPlayerControl",value:function(){this.state.isHalted||this.domRefs.playerControl.classList.add("fade-out")}},{key:"getCursorTime",value:function(e){var t=document.querySelector(".player-progressbar-wrap"),i=e.clientX-t.getBoundingClientRect().left,n=(i=Math.max(0,i))/t.clientWidth;return n=Math.min(n,1),this.options.duration*n*1e3}},{key:"handlePlayButtonClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.togglePlay()}},{key:"handlePlayerDoubleTap",value:function(){this.togglePlay()}},{key:"togglePlay",value:function(){var e=this.domRefs.playState;this[this.state.isHalted?"play":"halt"](),this.state.isHalted=!this.state.isHalted,e.title=this.state.isHalted?"播放":"暂停",e.firstElementChild.className=this.state.isHalted?"fa fa-play":"fa fa-pause",this.showPlayerControl()}},{key:"wait",value:function(){this.setLoadingTipStatus(!0),this.halt()}},{key:"halt",value:function(){this.domRefs.audio.pause(),window.clearTimeout(this.state.nextAction),window.cancelAnimationFrame(this.state.animation)}},{key:"continue",value:function(){this.setLoadingTipStatus(!1),this.state.isHalted||this.domRefs.audio.play()}},{key:"play",value:function(){this.domRefs.audio.play(),this.registerNextAction(),this.registerNextAnimation()}},{key:"waitPageLoading",value:function(e,t){var i=this;this.wait(),this.state.waiting={waitingPage:e,waitingTime:t},this.domRefs.images[e].addEventListener("load",function(){var n=i.state,a=n.waiting,s=n.isLoading,r=a.waitingPage,o=a.waitingTime;s&&r===e&&t===o&&(i.continue(),i.changeCurrentTime(t))})}},{key:"changeCurrentTime",value:function(e){var t=this.domRefs.audio,i=this.state.isImagesLoaded;t.currentTime=e/1e3,this.rerenderTimeInfo();var n=this.getPageByTime(e);if(i[n]){this.state.isLoading&&this.continue(),window.clearTimeout(this.state.nextAction),window.cancelAnimationFrame(this.state.animation),this.state.animationObj=null,this.pageTo(n),this.setPageState(n,e),this.setDraftState(e);var a=this.getNextAction(e);this.state.nextActionIndex=a?a.actionId:-1,this.state.isHalted||(this.registerNextAction(),this.registerNextAnimation()),this.changeDisplaySubtitle(e)}else this.waitPageLoading(n,e)}},{key:"registerNextAction",value:function(){var e=this,t=this.actionData.actions,i=this.domRefs.audio,n=this.state.nextActionIndex;n>=t.length||n<0||(this.state.nextAction=window.setTimeout(function(){e.handleNextAction(!0)},t[n].startTime-1e3*i.currentTime))}},{key:"registerNextAnimation",value:function(){var e=this.state.animationObj;if(e){var t=e.elaspedTime;e.startTime=Date.now()-t,this.state.animation=requestAnimationFrame(this.drawPoint.bind(this))}}},{key:"handleNextAction",value:function(e){var t=this.actionData.actions,i=t[this.state.nextActionIndex];switch(i.type){case"path":this.drawPath(i,e);break;case"arrow":this.drawArrow(i,e);break;case"scroll":this.scroll(i,e);break;case"page":this.page(i,e);break;case"withdraw":this.withdraw(i);break;case"clear":this.clear(i);break;case"eliminate":this.eliminate(i);break;case"draft":this.draft(i)}e&&this.state.nextActionIndex<t.length-1&&(++this.state.nextActionIndex,this.registerNextAction())}},{key:"handleActions",value:function(e,t){var i=this,n=this.state,a=n.nextActionIndex,s=n.ctx,r=n.propotion,o=s.canvas;e.forEach(function(n,a){if(a===e.length-1&&"path"===n.type){var l=n.startTime,c=n.endTime,d=n.points,h=c-l,u=d.length,p=Math.floor((t-l)/h*u);if(p=Math.min(p,u),s.strokeStyle=n.color,s.lineWidth=Math.max(r*n.width,1.5),i.backgroundData=s.getImageData(0,0,o.width,o.height),i.drawPoints(d,p),p>=u)i.state.animationObj=null;else{var m=h*(p/u);i.state.animationObj={points:d,startTime:Date.now()-m,duration:h,elaspedTime:m}}}else i.state.nextActionIndex=n.actionId,i.handleNextAction(!1)}),this.state.nextActionIndex=a}},{key:"drawPoints",value:function(e,t){var i=this.state,n=i.ctx,a=i.propotion;n.beginPath(),e.slice(0,t).forEach(function(e,t){var i=e[0]*a,s=e[1]*a;0===t?n.moveTo(i,s):n.lineTo(i,s)}),n.stroke()}},{key:"drawPath",value:function(e,t){var i=e.points,n=e.width,a=e.color,s=e.startTime,r=e.endTime,o=this.state,l=o.ctx,c=o.propotion;if(i.length)if(l.lineWidth=n*c,l.lineWidth=Math.max(1.5,l.lineWidth),l.strokeStyle=a,t){var d=r-s;this.backgroundData=l.getImageData(0,0,l.canvas.width,l.canvas.height),this.state.animationObj={points:i,startTime:Date.now(),duration:d,elaspedTime:0},this.state.animation=requestAnimationFrame(this.drawPoint.bind(this))}else this.drawPoints(i,i.length-1)}},{key:"drawPoint",value:function(){if(this.state.animationObj){var e=this.state.animationObj,t=e.points,i=e.startTime,n=e.duration,a=this.state,s=a.ctx,r=a.propotion,o=t.length;s.clearRect(0,0,s.canvas.width,s.canvas.height),s.putImageData(this.backgroundData,0,0);var l=Date.now()-i,c=l/n,d=Math.ceil(t.length*c);d=Math.min(d,o),s.beginPath();for(var h=0;h<d;++h){var u=t[h],p=u[0]*r,m=u[1]*r;0===h?s.moveTo(p,m):s.lineTo(p,m)}s.stroke(),d<o?(this.state.animationObj.elaspedTime=l,this.state.animation=requestAnimationFrame(this.drawPoint.bind(this))):(this.state.animation=null,this.state.animationObj=null)}}},{key:"drawArrow",value:function(e){var t=this.state,i=t.propotion,n=t.ctx,a=e.points;n.lineWidth=e.width*i,n.fillStyle=e.color;var s=a[0][0]*i,r=a[0][1]*i,o=a[1][0]*i,l=a[1][1]*i,c=Math.sqrt(Math.pow(s-o,2)+Math.pow(r-l,2)),d=o-10*i*(r-l)/c,h=l-10*i*(o-s)/c,u=o+20*i*(o-s)/c,p=l-20*i*(r-l)/c,m=o+10*i*(r-l)/c,f=l+10*i*(o-s)/c,v=o-5*i*(r-l)/c,g=l-5*i*(o-s)/c,y=o+5*i*(r-l)/c,b=l+5*i*(o-s)/c;n.beginPath(),n.moveTo(s,r),n.lineTo(v,g),n.lineTo(d,h),n.lineTo(u,p),n.lineTo(m,f),n.lineTo(y,b),n.fill()}},{key:"clear",value:function(){var e=this.state.ctx;e.clearRect(0,0,e.canvas.width,e.canvas.height)}},{key:"eliminate",value:function(e){if(this.state.isdraftOpen)this.setDraftState(e.startTime+1);else{var t=this.getPageByTime(e.startTime);this.setPageState(t,e.startTime+1)}}},{key:"withdraw",value:function(e){if(this.state.isdraftOpen)this.setDraftState(e.startTime+1);else{var t=this.getPageByTime(e.startTime);this.setPageState(t,e.startTime+1)}}},{key:"draft",value:function(e){this.toggleDraft("open"===e.status,!0)}},{key:"toggleDraft",value:function(e,t){var i=this.domRefs.draft;i.style.transition=t?"width 0.2s linear":"none",e?(i.style.width=this.state.draftWidth+"px",this.state.isdraftOpen=!0):(i.style.width="0",this.state.isdraftOpen=!1),this.setDrawTarget()}},{key:"setDrawTarget",value:function(){var e=this.state,t=e.isdraftOpen,i=e.draftNum,n=e.propotions,a=e.contexts,s=0,r=0;t&&(s=i,r=1),this.state.ctx=a[s],this.state.propotion=n[r]}},{key:"scroll",value:function(e,t){var i=this.domRefs,n=i.images,a=i.canvas,s=this.options.scrollDuration,r=this.state.propotion,o=n[this.getPageByTime(e.startTime)],l=e.yDistance*r,c=0,d=o.style.transform.match(/translateY\(-(.*)px\)/);d&&(c=window.parseInt(d[1],10));var h=Math.abs(c-l)/o.offsetHeight*r*s;t?(o.style.transition="transform "+h+"s linear",a.style.transition="transform "+h+"s linear"):(o.style.transition="",a.style.transition=""),o.style.transform="translateY("+-l+"px)",a.style.transform="translateY("+-l+"px)"}},{key:"page",value:function(e,t){var i=this.domRefs.pages,n=this.getPageByTime(e.startTime)+("next"===e.direction?1:-1);n>=i.length||n<0||(this.state.isImagesLoaded[n]?(this.pageTo(n,t),this.setPageState(n,e.startTime)):this.waitPageLoading(n,e.startTime-1))}},{key:"setPageState",value:function(e,t){var i=this.domRefs.images;this.state.isdraftOpen=!1,this.setDrawTarget();var n=this.state.ctx,a=n.canvas;n.clearRect(0,0,a.width,a.height),a.style.transform="translateY(0px)",i[e].style.transform="translateY(0px)";var s=this.getDrawActionsOnPage(e,t);this.handleActions(s,t)}},{key:"setDraftState",value:function(e){this.state.isdraftOpen=!0,this.setDrawTarget();var t=this.state.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height);var i=this.getActionsOnDraft(e);this.handleActions(i,e),this.state.isdraftOpen="open"===this.getDraftStatus(e),this.toggleDraft(this.state.isdraftOpen,!1)}},{key:"getDraftStatus",value:function(e){for(var t=this.actionData.actions,i="close",n=0;n<t.length&&e>t[n].startTime;++n){var a=t[n];"draft"===a.type&&(i=a.status)}return i}},{key:"getActionsOnDraft",value:function(t){for(var i=this.actionData.actions,n=[],a=!1,s=0;s<i.length&&t>i[s].startTime;++s){var r=i[s];"draft"===r.type?a="open"===r.status:a&&n.push(r)}return e.filterActions(n)}},{key:"pageTo",value:function(e,t){this.domRefs.pages.forEach(function(i){i.style.transition=t?"transform 0.2s ease":"none",i.style.transform="translateY(-"+i.offsetHeight*e+"px)"})}},{key:"getPageByTime",value:function(e){for(var t=this.actionData.actions,i=0,n=0;n<t.length&&t[n].startTime<e;++n)"page"===t[n].type&&(i+="prev"===t[n].direction?-1:1);return i}},{key:"getDrawActionsOnPage",value:function(t,i){return e.filterActions(this.getActionsOnPage(t,i))}},{key:"getActionsOnPage",value:function(e,t){for(var i=this.actionData.actions,n=0,a=[],s=!1,r=0;r<i.length&&i[r].startTime<t;++r){var o=i[r];"draft"!==o.type?(n!==e||s||a.push(o),"page"===o.type&&(n+="next"===o.direction?1:-1)):s="open"===o.status}return a}},{key:"getNextAction",value:function(e){for(var t=this.actionData.actions,i=0;i<t.length;++i){if(t[i].startTime>=e)return t[i]}}},{key:"changeDisplaySubtitle",value:function(e){var t=this.state,i=t.subtitles,n=t.isCaptionsOpen,a=t.currentSubtitleIndex,s=this.domRefs,r=s.playerContainer,o=s.captions;if(i.length){var l=-1,c=!1,d=void 0;for(d=parseFloat(i[a].beginTime)>e?0:a;d<i.length&&parseFloat(i[d].beginTime)<=e;++d)if(parseFloat(i[d].endTime)>=e){c=!0,l=d;break}c||(l=Math.min(i.length-1,d)),n&&(c?(o.style.display="block",o.lastElementChild.textContent=i[l].text):o.style.display="none");var h=new CustomEvent("subtitlechange",{bubbles:!0,detail:{hasSubtitle:c,subtitleIndex:l}});r.dispatchEvent(h),this.state.currentSubtitleIndex=l}}},{key:"updateSubtitles",value:function(e){this.state.subtitles=e}},{key:"unmount",value:function(){for(var e=this.domRefs,t=e.playerContainer,i=e.audio,n=e.fullscreen,a=e.pageFullscreen,s=e.playState,r=e.progressbarWrapper,o=e.playerControl,l=e.progressHandle,c=e.toggleCaptionsButton,d=e.captions,h=e.loadTip,u=e.images,p=this.state,m=p.nextAction,f=p.animation,v=p.hidePlayerControl;t.firstChild;)t.removeChild(t.firstChild);if("desktop"===this.options.mode&&(o.removeEventListener("mouseenter",this.showPlayerControl),o.removeEventListener("mousemove",this.showPlayerControl),h.removeEventListener("mouseenter",this.showPlayerControl),h.removeEventListener("mousemove",this.showPlayerControl),h.removeEventListener("click",this.handlePlayButtonClick),a.removeEventListener("click",this.handlePageFullscreenClick),r.removeEventListener("mouseover",this.handleProgressbarOver),r.removeEventListener("mouseleave",this.handleProgressbarleave),r.removeEventListener("mousemove",this.handleProgressbarOver),l.removeEventListener("mousedown",this.handleSeekMousedown),d.removeEventListener("mousedown",this.handleCaptionsDown)),i.removeEventListener("timeupdate",this.handleTimeUpdate),i.removeEventListener("ended",this.handleEnded),i.removeEventListener("canplay",this.handleAudioLoaded),i.removeEventListener("canplaythrough",this.handleAudioLoaded),i.removeEventListener("loadeddata",this.handleAudioLoaded),i.removeEventListener("loadedmetadata",this.handleAudioLoaded),s.removeEventListener("click",this.handlePlayButtonClick),n.removeEventListener("click",this.handleFullscreenClick),z.removeEventListener("fullscreenchange",this.handleFullscreenChange),c.removeEventListener("click",this.handleCaptionButtonClick),r.removeEventListener("click",this.handleProgressbarClick),window.removeEventListener("orientationchange",this.handleRotateScreen),window.removeEventListener("resize",this.handleWindowResize),u[0].removeEventListener("load",this.handleFirstImageLoaded),"mobile"===this.options.mode){var g=this.state.hammers,y=g.handleHammer,b=g.captionsHammer,w=g.loadTipHammer;if(y.destroy(),b.destroy(),w.destroy(),"mobile"===this.options.mode)h.querySelector(".player-load-button").removeEventListener("click",this.fetchSource)}window.clearTimeout(v),window.clearTimeout(m),f&&window.cancelAnimationFrame(f)}}],[{key:"filterActions",value:function(e){for(var t=["arrow","scroll","path","clear","eliminate"],i=["arrow","path","clear","eliminate"],n=[],a=[],s=0;s<e.length;++s){var r=e[s];if(-1!==t.indexOf(r.type)){var o=!1;if(-1!==i.indexOf(r.type))for(var l=1,c=s+1;c<e.length&&"page"!==e[c].type;++c){if("withdraw"===e[c].type&&!--l){o=!0;break}-1!==i.indexOf(e[c].type)&&++l}o||("eliminate"===r.type?a=a.concat(r.eliminateIds):n.push(r))}}return n.filter(function(e){return!e.id||-1===a.indexOf(e.id)})}},{key:"normalizeTime",value:function(e){e=Math.floor(e);var t=Math.floor(e/3600),i=e%3600,n=Math.floor(i/60),a=i%60,s="";return s+=t?t+":":"",t&&n<10&&(s+="0"),s+=n+":",a<10&&(s+="0"),s+=a}},{key:"renderStringToNode",value:function(e,t){var i=document.createElement("div");return i.innerHTML=t,e.appendChild(i.firstElementChild),e.lastElementChild}}]),e}(),N=i("kfHR"),j=i.n(N),q=(i("J48R"),{name:"Comment",props:{docId:{type:String,required:!0},comments:{type:Array,required:!0},userType:{type:[String,Number],required:!0}},data:function(){return{activeCommentIndex:-1,activeReplyIndex:-1,approveL:0,approveList:[],commentId:"",commentList:this.comments,commentObj:{},images:[],index:-1,inputImage:"",isShowUploadImagesDialog:!1,myComment:"",preview0:"",preview1:"",preview2:"",replyFormData:new FormData,replyId:-1,replyList:[],replyText:"",replyType:"",replyVisible:!1,rrVisible:!1,showImgUrl:"",showImgVisible:!1,uploadFile:[]}},watch:{comments:function(){this.commentList=this.comments,-1!==this.activeCommentIndex&&this.replyVisible&&(this.commentObj=this.commentList[this.activeCommentIndex])},commentObj:function(){O()(this.commentObj).length&&(this.approveL=this.commentObj.approve.length,this.replyList=this.commentObj.replies,this.replyFormData=new FormData,this.replyFormData.append("commentId",this.commentObj.id),"comment"===this.replyType?this.replyFormData.append("sourceId",this.commentObj.accountId):this.replyFormData.append("sourceId",this.commentObj.replies[this.activeReplyIndex].accountId))},replyVisible:function(){this.replyVisible||(this.commentObj={})}},methods:{confirmComment:function(){var e=this;if(""===this.myComment&&""===this.preview0)Object(s.Toast)("请输入评论");else{var t=new FormData;t.append("text",this.myComment),t.append("docId",this.docId),this.uploadFile.forEach(function(e){t.append("files",e)}),s.Indicator.open("发表评论中"),this.$http.post("/comments/",t).then(function(t){e.$emit("addCommentSuccess",t.data)}).then(function(){s.Indicator.close(),Object(s.Toast)({message:"评论成功",iconClass:"fa fa-check"})}).catch(function(e){s.Indicator.close(),Object(s.Toast)({message:"评论失败",iconClass:"fa fa-exclamation-triangle"})}),this.myComment="",this.removeUploadImages()}},clickUploadImageInputForComment:function(){this.inputImage="",this.$refs.uploadImageInputForComment.click()},clickUploadImageInputForReply:function(){this.inputImage="",this.$refs.uploadImageInputForReply.click()},handleInputChange:function(e){var t=this;e.target.files&&(this.uploadFile=j()(e.target.files),this.uploadFile.forEach(function(e){""===t.preview0?t.preview0=window.URL.createObjectURL(e):""===t.preview1?t.preview1=window.URL.createObjectURL(e):t.preview2=window.URL.createObjectURL(e)}))},confirmUploadImages:function(){this.isShowUploadImagesDialog=!1},cancelUploadImages:function(){this.isShowUploadImagesDialog=!1,this.removeUploadImages()},removeUploadImages:function(){this.uploadFile=[],this.preview0="",this.preview1="",this.preview2=""},showImg:function(e){this.showImgUrl=e,this.showImgVisible=!0},handleOnReply:function(e,t,i){-1!==e&&(this.activeCommentIndex=e),-1!==t&&(this.activeReplyIndex=t),this.replyType=i,this.commentObj=this.commentList[this.activeCommentIndex],this.replyVisible=!0,this.rrVisible=!0},confirmReply:function(){var e=this;this.rrVisible=!1,this.confirmUploadImages(),""===this.replyText&&""===this.preview0?Object(s.Toast)("请输入回复"):(s.Indicator.open("发表回复中"),this.uploadFile.forEach(function(t){e.replyFormData.append("files",t)}),this.replyFormData.append("text",this.replyText),this.preview0="",this.$http.post("/comments/"+this.commentList[this.activeCommentIndex].id+"/reply",this.replyFormData).then(function(t){e.$emit("addReplySuccess",t.data),e.replyText="",e.replyFormData=new FormData,e.removeUploadImages(),s.Indicator.close(),Object(s.Toast)({message:"回复成功",iconClass:"icon icon-success"})}).catch(function(e){s.Indicator.close(),Object(s.Toast)({message:"回复失败",iconClass:"fa fa-exclamation-triangle"})}))},cancleReply:function(){this.removeUploadImages(),this.rrVisible=!1,this.replyText=""},approveHandle:function(e,t,i){if(-1===e&&(e=this.activeCommentIndex),1===i?(this.commentId=this.commentList[e].id,this.accountId=this.commentList[e].accountId,this.approveList=this.commentList[e].approve):(this.commentId=this.commentList[e].replies[t].id,this.accountId=this.commentList[e].replies[t].accountId,this.approveList=this.commentList[e].replies[t].approve),-1===this.approveList.indexOf(this.accountId))document.getElementById("approve"+this.commentId).style.color="#2196F3",document.getElementById("approvepop"+this.commentId)&&(document.getElementById("approvepop"+this.commentId).style.color="#2196F3"),this.approveList.push(this.accountId),1===i&&(this.approveL=this.approveList.length),this.$http.put("/comments/"+this.commentId+"/approve",{approve:!0});else{var n=this.approveList.indexOf(this.accountId);this.approveList.splice(n,1),1===i&&(this.approveL=this.approveList.length),document.getElementById("approve"+this.commentId).style.color="black",document.getElementById("approvepop"+this.commentId)&&(document.getElementById("approvepop"+this.commentId).style.color="black"),this.$http.put("/comments/"+this.commentId+"/approve",{approve:!1})}},formatTime:function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+this.paddingNumberWithZero(t.getHours())+":"+this.paddingNumberWithZero(t.getMinutes())+":"+this.paddingNumberWithZero(t.getSeconds())},paddingNumberWithZero:function(e){return e>9?String(e):"0"+e},handleOnDeleteComment:function(e){this.$emit("handleOnDeleteComment",e)},handleOnDeleteReply:function(e,t){this.$emit("handleOnDeleteReply",e,t)}}}),Q={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"commentContainer"},[i("mt-field",{staticClass:"commentInput",attrs:{placeholder:"评论",disableClear:""},model:{value:e.myComment,callback:function(t){e.myComment=t},expression:"myComment"}},[e.preview0?e._e():i("i",{staticClass:"fa fa-picture-o",staticStyle:{"font-size":"20px"},on:{click:function(t){e.isShowUploadImagesDialog=!0}}}),e._v(" "),e.preview0?i("img",{attrs:{width:"35px",src:e.preview0}}):e._e(),e._v(" "),i("mt-button",{staticStyle:{"margin-left":"10px",height:"35px","background-color":"#418642",color:"#FFF"},on:{click:function(t){e.confirmComment()}}},[e._v("\n      提交\n    ")])],1),e._v(" "),e._l(e.commentList,function(t,n){return i("div",{key:t.id,staticClass:"commentCell"},[i("div",{staticClass:"commentTop"},[i("img",{staticClass:"avatar",attrs:{src:t.avatar}}),e._v(" "),i("span",{staticClass:"userName"},[e._v(e._s(t.userName))]),e._v(" "),i("div",{staticClass:"approve"},[i("i",{staticClass:"fa fa-thumbs-o-up",staticStyle:{"font-size":"18px","margin-right":"5px"},attrs:{id:"approve"+t.id},on:{click:function(t){e.approveHandle(n,0,1)}}}),e._v(" "),i("span",[e._v(e._s(t.approve.length))])])]),e._v(" "),i("p",{staticClass:"text"},[e._v(e._s(t.text))]),e._v(" "),t.images.length?i("div",{staticClass:"imagesBox"},e._l(t.images,function(t){return i("img",{staticClass:"textImg",attrs:{src:t},on:{click:function(i){e.showImg(t)}}})})):e._e(),e._v(" "),i("span",{staticStyle:{color:"gray","font-size":"12px"}},[e._v("\n      "+e._s(e.formatTime(t.createTime))+"\n    ")]),e._v(" "),i("span",{staticClass:"replyBtn",on:{click:function(t){e.handleOnReply(n,-1,"comment")}}},[e._v("\n      回复("+e._s(t.replies.length)+")\n    ")]),e._v(" "),"master"===e.userType||e.userType===t.accountId?i("span",{staticClass:"deleteBtn",on:{click:function(i){e.handleOnDeleteComment(t.id)}}},[e._v("\n      删除\n    ")]):e._e()])}),e._v(" "),e.commentList.length?e._e():i("h3",{staticStyle:{color:"gray"}},[e._v("暂无评论，快来评论吧！")]),e._v(" "),i("mt-popup",{staticClass:"imagesUploadDialog",attrs:{"popup-transition":"popup-fade"},model:{value:e.isShowUploadImagesDialog,callback:function(t){e.isShowUploadImagesDialog=t},expression:"isShowUploadImagesDialog"}},[i("div",[i("p",{staticStyle:{"padding-bottom":"10px",color:"#555"}},[e._v("最多可上传3张图片")]),e._v(" "),i("div",{staticStyle:{display:"flex","align-items":"center"}},[""!==e.preview0?i("img",{staticStyle:{"border-radius":"5px",border:"solid 1px #DDD","margin-right":"10px"},attrs:{src:e.preview0,height:"100px"}}):e._e(),e._v(" "),""!==e.preview1?i("img",{staticStyle:{"border-radius":"5px",border:"solid 1px #DDD","margin-right":"10px"},attrs:{src:e.preview1,height:"100px"}}):e._e(),e._v(" "),""!==e.preview2?i("img",{staticStyle:{"border-radius":"5px",border:"solid 1px #DDD","margin-right":"10px"},attrs:{src:e.preview2,height:"100px"}}):e._e(),e._v(" "),""===e.preview2?i("i",{staticClass:"fa fa-plus-square-o",staticStyle:{"font-size":"100px","padding-left":"10px","padding-right":"10px","border-radius":"5px",border:"solid 1px #DDD"},on:{click:e.clickUploadImageInputForComment}}):e._e(),e._v(" "),i("input",{ref:"uploadImageInputForComment",staticStyle:{display:"none"},attrs:{accept:"image/*",type:"file",multiple:""},domProps:{value:e.inputImage},on:{change:e.handleInputChange}})]),e._v(" "),i("div",{staticStyle:{display:"flex","justify-content":"center","align-self":"center","margin-top":"30px"}},[i("mt-button",{staticStyle:{"margin-right":"10px","padding-left":"30px","padding-right":"30px"},on:{click:e.confirmUploadImages}},[e._v("\n          确定\n        ")]),e._v(" "),i("mt-button",{staticStyle:{"margin-left":"10px","padding-left":"30px","padding-right":"30px"},on:{click:e.cancelUploadImages}},[e._v("\n          取消\n        ")])],1)])]),e._v(" "),Object.keys(e.commentObj).length?i("mt-popup",{staticClass:"replyPop",attrs:{position:"right"},model:{value:e.replyVisible,callback:function(t){e.replyVisible=t},expression:"replyVisible"}},[i("div",[i("mt-button",{staticStyle:{"margin-top":"10px","margin-bottom":"10px","padding-left":"10px","padding-right":"10px"},on:{click:function(t){e.replyVisible=!1}}},[e._v("\n        返回\n      ")])],1),e._v(" "),i("div",{staticClass:"commentCell"},[i("div",{staticClass:"commentTop"},[i("img",{staticClass:"avatar",attrs:{src:e.commentObj.avatar}}),e._v(" "),i("span",{staticClass:"userName"},[e._v(e._s(e.commentObj.userName))]),e._v(" "),i("div",{staticClass:"approve"},[i("i",{staticClass:"fa fa-thumbs-o-up",staticStyle:{"font-size":"18px","margin-right":"5px"},attrs:{id:"approvepop"+e.commentObj.id},on:{click:function(t){e.approveHandle(-1,0,1)}}}),e._v(" "),i("span",[e._v(e._s(e.approveL))])])]),e._v(" "),i("p",{staticClass:"text"},[e._v(e._s(e.commentObj.text))]),e._v(" "),e.commentObj.images.length?i("div",{staticClass:"imagesBox"},e._l(e.commentObj.images,function(t){return i("img",{staticClass:"textImg",attrs:{src:t},on:{click:function(i){e.showImg(t)}}})})):e._e(),e._v(" "),i("span",{staticStyle:{color:"gray","font-size":"12px"}},[e._v("\n        "+e._s(e.formatTime(e.commentObj.createTime))+"\n      ")]),e._v(" "),i("span",{staticClass:"replyBtn",on:{click:function(t){e.handleOnReply(-1,-1,"comment")}}},[e._v("\n        回复("+e._s(e.replyList.length)+")\n      ")])]),e._v(" "),i("hr"),e._v(" "),e._l(e.replyList,function(t,n){return i("div",{staticClass:"commentCell"},[i("div",{staticClass:"commentTop"},[i("img",{staticClass:"avatar",attrs:{src:t.avatar}}),e._v(" "),i("span",{staticClass:"userName"},[e._v(e._s(t.userName))]),e._v(" "),i("span",{staticStyle:{"font-size":"14px",color:"gray","margin-left":"5px","margin-right":"5px"}},[e._v("@:")]),e._v(" "),i("span",{staticClass:"userName"},[e._v(e._s(t.originUserName))]),e._v(" "),i("div",{staticClass:"approve"},[i("i",{staticClass:"fa fa-thumbs-o-up",staticStyle:{"font-size":"18px","margin-right":"5px"},attrs:{id:"approve"+t.id},on:{click:function(t){e.approveHandle(e.index,n,2)}}}),e._v(" "),i("span",[e._v(e._s(t.approve.length))])])]),e._v(" "),i("p",{staticClass:"text"},[e._v(e._s(t.text))]),e._v(" "),t.images.length?i("div",{staticClass:"imagesBox"},e._l(t.images,function(t){return i("img",{staticClass:"textImg",attrs:{src:t},on:{click:function(i){e.showImg(t)}}})})):e._e(),e._v(" "),i("span",{staticStyle:{color:"gray","font-size":"12px"}},[e._v("\n        "+e._s(e.formatTime(t.createTime))+"\n      ")]),e._v(" "),i("span",{staticClass:"replyBtn",on:{click:function(t){e.handleOnReply(-1,n,"reply")}}},[e._v("\n        回复\n      ")]),e._v(" "),"master"===e.userType||e.userType===t.accountId?i("span",{staticClass:"deleteBtn",on:{click:function(i){e.handleOnDeleteReply(e.commentObj.id,t.id)}}},[e._v("\n        删除\n      ")]):e._e()])})],2):e._e(),e._v(" "),i("mt-popup",{staticClass:"imagesUploadDialog",model:{value:e.rrVisible,callback:function(t){e.rrVisible=t},expression:"rrVisible"}},[i("mt-field",{staticClass:"replyInput",attrs:{placeholder:"请输入回复"},model:{value:e.replyText,callback:function(t){e.replyText=t},expression:"replyText"}}),e._v(" "),i("div",{staticStyle:{"text-align":"left","margin-top":"5px"}},[i("p",{staticStyle:{"font-size":"12px",color:"gray",margin:"0 12px"}},[e._v("至多可提交3张图片")]),e._v(" "),""!==e.preview0?i("img",{staticStyle:{"margin-left":"10px"},attrs:{src:e.preview0,height:"70px"}}):e._e(),e._v(" "),""!==e.preview1?i("img",{attrs:{src:e.preview1,height:"70px"}}):e._e(),e._v(" "),""!==e.preview2?i("img",{attrs:{src:e.preview2,height:"70px"}}):e._e(),e._v(" "),""===e.preview2?i("i",{staticClass:"fa fa-plus-square-o",staticStyle:{"font-size":"70px","margin-left":"5%"},on:{click:e.clickUploadImageInputForReply}}):e._e(),e._v(" "),i("input",{ref:"uploadImageInputForReply",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:""},domProps:{value:e.inputImage},on:{change:e.handleInputChange}})]),e._v(" "),i("div",{staticStyle:{display:"flex","justify-content":"center","align-self":"center","margin-top":"30px"}},[i("mt-button",{staticStyle:{"margin-right":"10px","padding-left":"30px","padding-right":"30px"},on:{click:e.confirmReply}},[e._v("\n        确定\n      ")]),e._v(" "),i("mt-button",{staticStyle:{"margin-left":"10px","padding-left":"30px","padding-right":"30px"},on:{click:e.cancleReply}},[e._v("\n        取消\n      ")])],1)],1),e._v(" "),i("mt-popup",{staticClass:"showImg",attrs:{position:"right"},model:{value:e.showImgVisible,callback:function(t){e.showImgVisible=t},expression:"showImgVisible"}},[i("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.showImgUrl}})])],2)},staticRenderFns:[]};var V=i("46Yf")(q,Q,!1,function(e){i("4ai5")},"data-v-1b44363e",null).exports,Y={name:"Score",props:{accountId:{type:Number,required:!0},score:{type:Number,required:!0},teacherInformation:{type:Object,required:!0,default:function(){return{}}}}},X={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"score"},[i("div",{staticClass:"left"},[i("span",{staticStyle:{"font-size":"16px","font-weight":"800","margin-right":"5px"}},[e._v("\n      评分:\n    ")]),e._v(" "),i("span",{staticStyle:{"font-size":"16px","font-weight":"800"}},[e._v("\n      "+e._s(-1===e.score?"暂无评分":e.score+"/5")+"\n    ")])]),e._v(" "),-1!==e.accountId&&Object.keys(e.teacherInformation).length?i("router-link",{staticClass:"right",attrs:{to:"/teacher/"+e.accountId}},[i("img",{staticStyle:{width:"30px",height:"30px","border-radius":"50%"},attrs:{src:e.teacherInformation.avatar}}),e._v(" "),i("span",{staticStyle:{color:"#000","font-size":"16px"}},[e._v("\n      "+e._s(e.teacherInformation.name||e.teacherInformation.nickname)+"\n    ")]),e._v(" "),i("i",{staticClass:"fa fa-angle-right",staticStyle:{color:"#000","font-size":"20px"}})]):e._e()],1)},staticRenderFns:[]};var G=i("46Yf")(Y,X,!1,function(e){i("Sa+7")},"data-v-292d2f14",null).exports,K={name:"Subtitles",props:{activeSubtitleIndex:{type:Number,required:!0},subtitles:{type:Array,required:!0},subtitleContainerMarginTop:{type:Number,required:!0}},data:function(){return{count:0,scroll:"",text:"",time:""}},updated:function(){if(this.$refs.activeSubtitle&&this.$refs.activeSubtitle[0]){var e=this.$refs.activeSubtitle[0].offsetTop,t=this.$refs.activeSubtitle[0].clientHeight;"iOS"===this.$browser.os?document.body.scrollTop=e-(window.innerHeight-this.subtitleContainerMarginTop-t)/2:document.documentElement.scrollTop=e-(window.innerHeight-this.subtitleContainerMarginTop-t)/2}},methods:{formatDuring:function(e){var t=parseInt(e%36e5/6e4),i=parseInt(e%6e4/1e3);return i<10&&(i="0"+i),t<10&&(t="0"+t),t+":"+i}}},Z={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"subtitles",style:e.subtitleContainerMarginTop?{marginTop:e.subtitleContainerMarginTop+"px"}:void 0},[e._l(e.subtitles,function(t,n){return i("div",{key:t.beginTime,ref:n===e.activeSubtitleIndex?"activeSubtitle":void 0,refInFor:!0,staticClass:"subtitle",class:{activeSubtitle:n===e.activeSubtitleIndex}},[i("span",{staticClass:"start"},[e._v(e._s(e.formatDuring(t.beginTime)))]),e._v(" "),i("span",{staticClass:"wordstext"},[e._v(e._s(t.text))])])}),e._v(" "),e.subtitles.length?e._e():i("h3",{staticStyle:{color:"gray","margin-top":"100px"}},[e._v("\n    暂无字幕\n  ")])],2)},staticRenderFns:[]};var J={name:"Player",data:function(){return{accountId:-1,activeSubtitleIndex:-1,comments:[],docId:"",myInformation:{},pictures:[],player:{},score:-1,selected:"comment",subtitleContainerMarginTop:0,subtitles:[],teacherInformation:{},title:"课程名称",usersInformation:{}}},components:{MyHeader:v,Comment:V,Score:G,Subtitles:i("46Yf")(K,Z,!1,function(e){i("m7Gm")},"data-v-5532351d",null).exports},mounted:function(){var e=this;this.$route.params.id&&(this.docId=this.$route.params.id,this.$http.get("/players/"+this.docId).then(function(t){var i=t.data,n=i.accounts,a=i.comments,s=i.doc,r=s.accountId,o=s.action,l=s.defaultAction,c=s.name,d=s.pictures,h=s.ratingStatis,u=h.star1,p=h.star2,m=h.star3,f=h.star4,v=h.star5;e.usersInformation=n,e.accountId=r,e.teacherInformation=e.usersInformation.find(function(t){return t.id===e.accountId}),e.title=c,e.comments=a,e.comments.sort(function(e,t){return Date.parse(t.createTime)-Date.parse(e.createTime)}).forEach(function(t){var i=e.usersInformation.find(function(e){return e.id===t.accountId});t.userName=i.name||i.nickname,t.avatar=i.avatar,t.replies.sort(function(e,t){return Date.parse(t.createTime)-Date.parse(e.createTime)}).forEach(function(t){var i=e.usersInformation.find(function(e){return e.id===t.accountId}),n=e.usersInformation.find(function(e){return e.id===t.sourceId});t.userName=i.name||i.nickname,t.avatar=i.avatar,t.originUserName=n.name||n.nickname,t.originAvatar=n.avatar})});var g=o.find(function(e){return e.id===l});e.subtitles=g.subtitle,e.pictures=d,e.score=(u+2*p+3*m+4*f+5*v)/(u+p+m+f+v),e.score=window.isNaN(e.score)?-1:e.score,e.player=new H({actionUrl:g.json,audioUrl:g.recording,duration:g.duration,element:document.getElementById("player"),imageUrls:e.pictures,mode:"mobile",size:g.totalSize,subtitles:g.subtitle}),e.handleOnSetSubtitleContainerMarginTop();var y=e.title,b=e.pictures[0],x=e.teacherInformation.name||e.teacherInformation.nickname,k=e.teacherInformation.introduction;w(window.encodeURIComponent(window.location.href)),window.jWeixin.ready(function(){C({title:x+":《"+y+"》",desc:""+k,link:window.location.href,imgUrl:b})})}).catch(function(e){alert("获取数据错误，请检查访问地址")})),this.$http.get("/accounts").then(function(t){var i=t.data;e.myInformation=i})},computed:{userType:function(){return this.myInformation&&O()(this.myInformation).length?this.myInformation.id===this.teacherInformation?"master":this.myInformation.id:""}},methods:{handleOnSubtitleChange:function(e){this.activeSubtitleIndex=e.detail.subtitleIndex},handleOnSetSubtitleContainerMarginTop:function(){this.subtitleContainerMarginTop=this.$refs.playerWrapper.offsetHeight},handleOnAddCommentSuccess:function(e){e.userName=this.myInformation.name||this.myInformation.nickname,e.avatar=this.myInformation.avatar,this.comments.unshift(e)},handleOnAddReplySuccess:function(e){var t=this;e.userName=this.myInformation.name||this.myInformation.nickname,e.avatar=this.myInformation.avatar,e.replies.sort(function(e,t){return Date.parse(t.createTime)-Date.parse(e.createTime)}).forEach(function(e){var i=t.usersInformation.find(function(t){return t.id===e.accountId}),n=t.usersInformation.find(function(t){return t.id===e.sourceId});e.userName=i.name||i.nickname,e.avatar=i.avatar,e.originUserName=n.name||n.nickname,e.originAvatar=n.avatar});var i=this.comments.findIndex(function(t){return t.id===e.id});this.comments.splice(i,1,e)},handleOnDeleteComment:function(e){var t=this;s.Indicator.open("删除评论中"),this.$http.delete("/comments/"+e).then(function(){s.Indicator.close();var i=t.comments.findIndex(function(t){return t.id===e});t.comments.splice(i,1)}).catch(function(e){s.Indicator.close(),alert("删除评论失败，请稍后重试")})},handleOnDeleteReply:function(e,t){var i=this;s.Indicator.open("删除回复中"),this.$http.delete("/comments/"+e+"/reply/"+t).then(function(){s.Indicator.close();var n=i.comments.find(function(t){return t.id===e}),a=n.replies.findIndex(function(e){return e.id===t});n.replies.splice(a,1)}).catch(function(e){s.Indicator.close(),alert("删除回复失败，请稍后重试")})}}},ee={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("div",{ref:"playerWrapper",style:"subtitles"===e.selected?{position:"fixed",left:"0",top:"0",zIndex:"100",width:"100%"}:void 0},[i("MyHeader",{attrs:{title:e.title}}),e._v(" "),i("div",{attrs:{id:"player"},on:{actionsLoaded:e.handleOnSetSubtitleContainerMarginTop,subtitlechange:e.handleOnSubtitleChange}}),e._v(" "),i("mt-navbar",{staticClass:"selectToolBar",model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[i("mt-tab-item",{style:"comment"===e.selected?{borderBottom:"3px solid #418642"}:void 0,attrs:{id:"comment"}},[i("span",{staticStyle:{"font-size":"18px",color:"#666","font-weight":"800"},style:"comment"===e.selected?{color:"#418642"}:void 0},[e._v("\n          评论\n        ")])]),e._v(" "),i("mt-tab-item",{style:"subtitles"===e.selected?{borderBottom:"3px solid #418642"}:void 0,attrs:{id:"subtitles"}},[i("span",{staticStyle:{"font-size":"18px",color:"#666","font-weight":"800"},style:"subtitles"===e.selected?{color:"#418642"}:void 0},[e._v("\n          字幕\n        ")])])],1)],1),e._v(" "),i("mt-tab-container",{model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[i("mt-tab-container-item",{attrs:{id:"comment"}},[i("Score",{attrs:{accountId:e.accountId,score:e.score,teacherInformation:e.teacherInformation}}),e._v(" "),i("Comment",{attrs:{docId:e.docId,comments:e.comments,userType:e.userType},on:{addCommentSuccess:e.handleOnAddCommentSuccess,addReplySuccess:e.handleOnAddReplySuccess,handleOnDeleteComment:e.handleOnDeleteComment,handleOnDeleteReply:e.handleOnDeleteReply}})],1),e._v(" "),i("mt-tab-container-item",{attrs:{id:"subtitles"}},[i("Subtitles",{attrs:{subtitles:e.subtitles,activeSubtitleIndex:e.activeSubtitleIndex,subtitleContainerMarginTop:e.subtitleContainerMarginTop}})],1)],1)],1)},staticRenderFns:[]};var te=i("46Yf")(J,ee,!1,function(e){i("PaBX")},"data-v-e71d589e",null).exports,ie=i("+EMP"),ne=i.n(ie),ae={name:"Teacher",data:function(){return{accountId:this.$route.params.id,defaultClassCoverPng:y.a,defaultTeacherCover:ne.a,documentNumberForEachLibrary:{},libraries:[],teacherInformation:{}}},mounted:function(){var e=this;s.Indicator.open("获取用户数据中"),this.$http.get("/players/accounts/"+this.accountId).then(function(t){var i=t.data,n=i.accounts,a=i.coopLibraries,r=i.libraries;e.teacherInformation=n.find(function(t){return String(t.id)===e.accountId}),e.libraries=r.concat(a),s.Indicator.close();var o=e.teacherInformation.avatar,l=e.teacherInformation.name||e.teacherInformation.nickname,c=e.teacherInformation.introduction;w(window.encodeURIComponent(window.location.href)),window.jWeixin.ready(function(){C({title:l+"的个人主页",desc:c,link:window.location.href,imgUrl:o})})}).catch(function(e){throw e})},watch:{libraries:function(){var e=this;this.libraries.forEach(function(t){e.documentNumberForEachLibrary[t.id]=t.docs.length+t.chapters.reduce(function(e,t){return e+t.docs.length},0)})}},methods:{pop:function(){Object(s.Toast)({message:"该课程已关闭",iconClass:"icon",position:"bottom"})}},components:{MyHeader:v}},se={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("MyHeader",{attrs:{title:"【个人主页】"}}),e._v(" "),i("div",{staticClass:"information"},[i("div",{staticClass:"message"},[i("img",{staticClass:"photo",attrs:{src:e.teacherInformation.avatar}}),e._v(" "),i("h3",{staticStyle:{color:"#FFFFFF"}},[e._v(e._s(e.teacherInformation.name||e.teacherInformation.nickname))]),e._v(" "),i("h5",{staticStyle:{color:"#C7C7C7"}},[e._v(e._s(e.teacherInformation.introduction))])]),e._v(" "),i("img",{staticClass:"backgroundImage",attrs:{src:e.teacherInformation.cover||e.defaultTeacherCover}})]),e._v(" "),i("div",{staticClass:"courseList"},e._l(e.libraries,function(t){return i("div",{staticClass:"coursesCell"},[i("router-link",{staticClass:"link",attrs:{to:"/course/"+t.id+"?accountId="+e.accountId}},[i("div",{staticClass:"imgcontainer"},[i("div",{staticClass:"image"},[i("img",{staticClass:"image",attrs:{src:t.isDefault?e.defaultClassCoverPng:t.cover||e.defaultClassCoverPng}})])]),e._v(" "),i("div",{staticClass:"msgcontainer"},[i("span",{staticClass:"courseName"},[e._v(e._s(t.name))]),e._v(" "),i("p",{staticClass:"alt"},[e._v(e._s(e.documentNumberForEachLibrary[t.id])+"个文档")])])])],1)}))],1)},staticRenderFns:[]};var re=i("46Yf")(ae,se,!1,function(e){i("ee18")},"data-v-e1b72fb0",null).exports;o.default.use(m.a);var oe=new m.a({mode:"history",routes:[{path:"/teacher/:id",name:"teacher",component:re},{path:"/course/:id",name:"course",component:S},{path:"/player/:id",name:"player",component:te}]}),le=new(i("Z4iZ").Browser)(window.navigator.userAgent),ce=void 0,de=document.cookie.match(/qingtoken=(QJWT [\w\.\-]+)/);document.cookie="qingtoken=none; expires="+new Date(0)+";",de?(ce=de[1],window.localStorage.setItem("token",de[1])):ce=window.localStorage.getItem("token"),c.a.defaults.baseURL="/api/v1",c.a.defaults.headers.common.Authorization=ce,c.a.interceptors.response.use(function(e){return e},function(e){var t=e.config,i=t.method,n=t.url,s=e.response;if(401===(s=void 0===s?{}:s).status)if("GET"===i.toUpperCase()&&n.endsWith("/accounts"))console.log("获取用户个人信息失败");else if(window.location.pathname.startsWith("/player/")){var r=window.encodeURIComponent(window.location.pathname),o="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxa53771df5d04e3d3&redirect_uri=https%3A%2F%2Fmobile.mamasousuo.com%2Fapi%2Fv1%2Fauthentication%2Fmobile&response_type=code&scope=snsapi_userinfo&state={{}}#wechat_redirect".replace(/\{\{.*?\}\}/,r);"Wechat"===le.browser?window.location.assign(o):h()(o,{message:"请复制下面的链接地址到微信中打开"})&&alert("请在微信中打开，链接地址已经复制到剪贴板")}return a.a.reject(e)}),o.default.config.productionTip=!1,o.default.prototype.$http=c.a,o.default.prototype.$browser=le,o.default.use(r.a),new o.default({el:"#app",components:{App:p},router:oe,template:"<App />"})},OQGB:function(e,t){},OmDG:function(e,t,i){e.exports=i.p+"static/img/defaultClassCover.4b577a3.png"},PaBX:function(e,t){},"Sa+7":function(e,t){},Z4iZ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t,n,a=i("hRKE"),s=i.n(a);t=this,n=function(){var e=this||{},t="undefined"!=typeof navigator?navigator:{},i=function(e,t){var i=navigator.mimeTypes;for(var n in i)if(i[n][e]==t)return!0;return!1};return function(n){var a=n||t.userAgent||{},s={Trident:a.indexOf("Trident")>-1||a.indexOf("NET CLR")>-1,Presto:a.indexOf("Presto")>-1,WebKit:a.indexOf("AppleWebKit")>-1,Gecko:a.indexOf("Gecko/")>-1,Safari:a.indexOf("Safari")>-1,Chrome:a.indexOf("Chrome")>-1||a.indexOf("CriOS")>-1,IE:a.indexOf("MSIE")>-1||a.indexOf("Trident")>-1,Edge:a.indexOf("Edge")>-1,Firefox:a.indexOf("Firefox")>-1||a.indexOf("FxiOS")>-1,"Firefox Focus":a.indexOf("Focus")>-1,Chromium:a.indexOf("Chromium")>-1,Opera:a.indexOf("Opera")>-1||a.indexOf("OPR")>-1,Vivaldi:a.indexOf("Vivaldi")>-1,Yandex:a.indexOf("YaBrowser")>-1,Arora:a.indexOf("Arora")>-1,Lunascape:a.indexOf("Lunascape")>-1,QupZilla:a.indexOf("QupZilla")>-1,"Coc Coc":a.indexOf("coc_coc_browser")>-1,Kindle:a.indexOf("Kindle")>-1||a.indexOf("Silk/")>-1,Iceweasel:a.indexOf("Iceweasel")>-1,Konqueror:a.indexOf("Konqueror")>-1,Iceape:a.indexOf("Iceape")>-1,SeaMonkey:a.indexOf("SeaMonkey")>-1,Epiphany:a.indexOf("Epiphany")>-1,360:a.indexOf("QihooBrowser")>-1,"360EE":a.indexOf("360EE")>-1,"360SE":a.indexOf("360SE")>-1,UC:a.indexOf("UC")>-1||a.indexOf(" UBrowser")>-1,QQBrowser:a.indexOf("QQBrowser")>-1,QQ:a.indexOf("QQ/")>-1,Baidu:a.indexOf("Baidu")>-1||a.indexOf("BIDUBrowser")>-1,Maxthon:a.indexOf("Maxthon")>-1,Sogou:a.indexOf("MetaSr")>-1||a.indexOf("Sogou")>-1,LBBROWSER:a.indexOf("LBBROWSER")>-1,"2345Explorer":a.indexOf("2345Explorer")>-1,TheWorld:a.indexOf("TheWorld")>-1,XiaoMi:a.indexOf("MiuiBrowser")>-1,Quark:a.indexOf("Quark")>-1,Qiyu:a.indexOf("Qiyu")>-1,Wechat:a.indexOf("MicroMessenger")>-1,Taobao:a.indexOf("AliApp(TB")>-1,Alipay:a.indexOf("AliApp(AP")>-1,Weibo:a.indexOf("Weibo")>-1,Douban:a.indexOf("com.douban.frodo")>-1,Suning:a.indexOf("SNEBUY-APP")>-1,iQiYi:a.indexOf("IqiyiApp")>-1,Windows:a.indexOf("Windows")>-1,Linux:a.indexOf("Linux")>-1||a.indexOf("X11")>-1,"Mac OS":a.indexOf("Macintosh")>-1,Android:a.indexOf("Android")>-1||a.indexOf("Adr")>-1,Ubuntu:a.indexOf("Ubuntu")>-1,FreeBSD:a.indexOf("FreeBSD")>-1,Debian:a.indexOf("Debian")>-1,"Windows Phone":a.indexOf("IEMobile")>-1||a.indexOf("Windows Phone")>-1,BlackBerry:a.indexOf("BlackBerry")>-1||a.indexOf("RIM")>-1,MeeGo:a.indexOf("MeeGo")>-1,Symbian:a.indexOf("Symbian")>-1,iOS:a.indexOf("like Mac OS X")>-1,"Chrome OS":a.indexOf("CrOS")>-1,WebOS:a.indexOf("hpwOS")>-1,Mobile:a.indexOf("Mobi")>-1||a.indexOf("iPh")>-1||a.indexOf("480")>-1,Tablet:a.indexOf("Tablet")>-1||a.indexOf("Pad")>-1||a.indexOf("Nexus 7")>-1},r=!1;if(e.chrome){var o=a.replace(/^.*Chrome\/([\d]+).*$/,"$1");o>36&&e.showModalDialog?r=!0:o>45&&(r=i("type","application/vnd.chromium.remoting-viewer"))}if(s.Mobile?s.Mobile=!(a.indexOf("iPad")>-1):r&&(i("type","application/gameplugin")?s["360SE"]=!0:s["360EE"]=!0),s.IE||s.Edge)switch(window.screenTop-window.screenY){case 71:case 74:case 99:case 102:s["360EE"]=!0;break;case 75:case 74:case 105:case 104:s["360SE"]=!0}var l,c={engine:["WebKit","Trident","Gecko","Presto"],browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Arora","Lunascape","QupZilla","Coc Coc","Kindle","Iceweasel","Konqueror","Iceape","SeaMonkey","Epiphany","360","360SE","360EE","UC","QQBrowser","QQ","Baidu","Maxthon","Sogou","LBBROWSER","2345Explorer","TheWorld","XiaoMi","Quark","Qiyu","Wechat","Taobao","Alipay","Weibo","Douban","Suning","iQiYi"],os:["Windows","Linux","Mac OS","Android","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"],device:["Mobile","Tablet"]};for(var d in this.device="PC",this.language=((l=(t.browserLanguage||t.language).split("-"))[1]&&(l[1]=l[1].toUpperCase()),l.join("_")),c)for(var h=0;h<c[d].length;h++){var u=c[d][h];s[u]&&(this[d]=u)}var p={Windows:function(){var e=a.replace(/^.*Windows NT ([\d.]+);.*$/,"$1");return{6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[e]||e},Android:function(){return a.replace(/^.*Android ([\d.]+);.*$/,"$1")},iOS:function(){return a.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,".")},Debian:function(){return a.replace(/^.*Debian\/([\d.]+).*$/,"$1")},"Windows Phone":function(){return a.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2")},"Mac OS":function(){return a.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,".")},WebOS:function(){return a.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")}};this.osVersion="",p[this.os]&&(this.osVersion=p[this.os](),this.osVersion==a&&(this.osVersion=""));var m={Safari:function(){return a.replace(/^.*Version\/([\d.]+).*$/,"$1")},Chrome:function(){return a.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1")},IE:function(){return a.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1")},Edge:function(){return a.replace(/^.*Edge\/([\d.]+).*$/,"$1")},Firefox:function(){return a.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1")},"Firefox Focus":function(){return a.replace(/^.*Focus\/([\d.]+).*$/,"$1")},Chromium:function(){return a.replace(/^.*Chromium\/([\d.]+).*$/,"$1")},Opera:function(){return a.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1")},Vivaldi:function(){return a.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1")},Yandex:function(){return a.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1")},Arora:function(){return a.replace(/^.*Arora\/([\d.]+).*$/,"$1")},Lunascape:function(){return a.replace(/^.*Lunascape[\/\s]([\d.]+).*$/,"$1")},QupZilla:function(){return a.replace(/^.*QupZilla[\/\s]([\d.]+).*$/,"$1")},"Coc Coc":function(){return a.replace(/^.*coc_coc_browser\/([\d.]+).*$/,"$1")},Kindle:function(){return a.replace(/^.*Version\/([\d.]+).*$/,"$1")},Iceweasel:function(){return a.replace(/^.*Iceweasel\/([\d.]+).*$/,"$1")},Konqueror:function(){return a.replace(/^.*Konqueror\/([\d.]+).*$/,"$1")},Iceape:function(){return a.replace(/^.*Iceape\/([\d.]+).*$/,"$1")},SeaMonkey:function(){return a.replace(/^.*SeaMonkey\/([\d.]+).*$/,"$1")},Epiphany:function(){return a.replace(/^.*Epiphany\/([\d.]+).*$/,"$1")},360:function(){return a.replace(/^.*QihooBrowser\/([\d.]+).*$/,"$1")},"360SE":function(){return{55:"9.1",45:"8.1",42:"8.0",31:"7.0",21:"6.3"}[a.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"360EE":function(){return{63:"9.5",55:"9.0",50:"8.7",30:"7.5"}[a.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},Maxthon:function(){return a.replace(/^.*Maxthon\/([\d.]+).*$/,"$1")},QQBrowser:function(){return a.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1")},QQ:function(){return a.replace(/^.*QQ\/([\d.]+).*$/,"$1")},Baidu:function(){return a.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/,"$1")},UC:function(){return a.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1")},Sogou:function(){return a.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1")},LBBROWSER:function(){return{57:"6.5",49:"6.0",46:"5.9",42:"5.3",39:"5.2",34:"5.0",29:"4.5",21:"4.0"}[navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"2345Explorer":function(){return a.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1")},TheWorld:function(){return a.replace(/^.*TheWorld ([\d.]+).*$/,"$1")},XiaoMi:function(){return a.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1")},Quark:function(){return a.replace(/^.*Quark\/([\d.]+).*$/,"$1")},Qiyu:function(){return a.replace(/^.*Qiyu\/([\d.]+).*$/,"$1")},Wechat:function(){return a.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1")},Taobao:function(){return a.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1")},Alipay:function(){return a.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1")},Weibo:function(){return a.replace(/^.*weibo__([\d.]+).*$/,"$1")},Douban:function(){return a.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1")},Suning:function(){return a.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1")},iQiYi:function(){return a.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")}};this.version="",m[this.browser]&&(this.version=m[this.browser](),this.version==a&&(this.version="")),"Edge"==this.browser?this.engine="EdgeHTML":"Chrome"==this.browser&&parseInt(this.version)>27?this.engine="Blink":"Opera"==this.browser&&parseInt(this.version)>12?this.engine="Blink":"Yandex"==this.browser&&(this.engine="Blink")}},"function"==typeof define&&(i("dTcb")||define.cmd)?define(n):"object"===("undefined"==typeof exports?"undefined":s()(exports))?e.exports=n():t.Browser=n()}.call(t,i("K61N")(e))},ee18:function(e,t){},fDbG:function(e,t){},m7Gm:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.46a3ced9fe068470a995.js.map